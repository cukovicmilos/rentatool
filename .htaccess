RewriteEngine On
RewriteBase /rentatool/

# Redirect to HTTPS (uncomment in production)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Prevent directory listing
Options -Indexes

# Protect sensitive files
<FilesMatch "\.(db|sqlite|log|ini|md)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Protect includes and classes folders
RewriteRule ^includes/ - [F,L]
RewriteRule ^classes/ - [F,L]

# Allow direct access to assets and uploads (headers still apply)
RewriteCond %{REQUEST_URI} ^/rentatool/assets/ [OR]
RewriteCond %{REQUEST_URI} ^/rentatool/uploads/
RewriteRule .* - [L]

# Admin routing
RewriteRule ^admin$ admin/ [R=301,L]
RewriteRule ^admin/$ admin/index.php [L]
RewriteRule ^admin/([a-z-]+)$ admin/$1.php [L]
RewriteRule ^admin/([a-z-]+)/([0-9]+)$ admin/$1.php?id=$2 [L,QSA]
RewriteRule ^admin/([a-z-]+)/([a-z-]+)$ admin/$1.php?action=$2 [L,QSA]
RewriteRule ^admin/([a-z-]+)/([a-z-]+)/([0-9]+)$ admin/$1.php?action=$2&id=$3 [L,QSA]

# API routing
RewriteRule ^api/([a-z-]+)$ api/$1.php [L,QSA]

# Frontend routing
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([a-z0-9-]+)$ pages/$1.php [L]

# Category pages
RewriteRule ^kategorija/([a-z0-9-]+)$ pages/kategorija.php?slug=$1 [L,QSA]

# Tool detail pages  
RewriteRule ^alat/([a-z0-9-]+)$ pages/alat.php?slug=$1 [L,QSA]

# Static pages
RewriteRule ^stranica/([a-z0-9-]+)$ pages/stranica.php?slug=$1 [L,QSA]

# Reservation cancel/view
RewriteRule ^rezervacija/([a-zA-Z0-9]+)$ pages/rezervacija.php?code=$1 [L,QSA]
RewriteRule ^rezervacija/otkazi/([a-zA-Z0-9]+)$ pages/otkazi.php?code=$1 [L,QSA]

# Default index
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^$ index.php [L]

# ============================================
# HTTP Caching Headers (SEO Performance)
# ============================================

# Enable mod_headers
<IfModule mod_headers.c>
    # Static assets - Cache for 1 year (immutable)
    <FilesMatch "\.(jpg|jpeg|png|gif|svg|webp|ico|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public, immutable"
    </FilesMatch>

    # CSS and JS - Cache for 1 month (with revalidation)
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "max-age=2592000, public, must-revalidate"
    </FilesMatch>

    # HTML pages - Cache for 1 hour
    <FilesMatch "\.html$">
        Header set Cache-Control "max-age=3600, public, must-revalidate"
    </FilesMatch>

    # PHP/Dynamic content - No cache
    <FilesMatch "\.php$">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
    </FilesMatch>

    # XML (sitemap) - Cache for 1 day
    <FilesMatch "\.xml$">
        Header set Cache-Control "max-age=86400, public"
    </FilesMatch>
</IfModule>

# Enable mod_expires as fallback
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
</IfModule>

# GZIP Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
    AddOutputFilterByType DEFLATE application/javascript application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>
